<div class="row" id="ct-states">
  <form id="filter-params" class="col s6">
    <div class="row">
      <div class="input-field col s6">
        <input name="from_state" id="from_state" type="text" class="validate state" autocomplete="off" value="<%= @board.config_property('cycle_times.in_progress.from') %>">
        <label for="from_state">From State</label>
      </div>
      <div class="input-field col s6">
        <input name="to_state" id="to_state" type="text" class="validate state" autocomplete="off" value="<%= @board.config_property('cycle_times.in_progress.to') %>">
        <label for="to_state">To State</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s6">
        <input name="from_date" id="from_date" type="text" class="datepicker" data-value="<%= (@board.synced_from || Time.now - 90.days).strftime('%Y-%m-%d') %>">
        <label for="from_date">From Date</label>
      </div>
      <div class="input-field col s6">
        <input name="to_date" id="to_date" type="text" class="datepicker" data-value="<%= Time.now.strftime('%Y-%m-%d') %>">
        <label for="to_date">To Date</label>
      </div>
    </div>
    <div class="row">
      <div class="input-field col s12">
        <textarea class="mono materialize-textarea" id="query" name="query"><%= @board.config_property('default_query') %></textarea>
        <label for="query">Query</label>
      </div>
    </div>
    <% if defined?(subquery) && subquery %>
      <div class="row">
        <div class="input-field col s12">
          <input name="selection_query" id="selection_query" type="text" class="validate" autocomplete="off">
          <label for="selection_query">Subquery</label>
        </div>
      </div>
    <% end %>
  </form>
  <div class="col s6">
    <ul class="collapsible popout" data-collapsible="expandable">
      <li>
        <div class="collapsible-header">
          <i class="material-icons">info_outline</i>
          Help with query language
        </div>
        <div class="collapsible-body">
          <p><strong>Select by field:</strong>
            <br><span class="mono">key = 'ISSUE-101'</span>
            <br><span class="mono">issue_type = 'Story'</span>
          </p>
          <p><strong>Applying filters:</strong>
            <br><span class="mono">filter = 'MyFilter'</span>
          </p>
          <p><strong>Set operations:</strong>
            <br><span class="mono">not filter = 'MyFilter'</span>
            <br><span class="mono">filter = 'MyFilter' and issue_type = 'Bug'</span>
            <br><span class="mono">not (filter = 'MyFilter' or issue_type = 'Bug')</span>
          </p>
          <p><strong>Date ranges (end-exclusive):</strong>
            <br><span class="mono">between ('2018-01-01', '2018-06-01')</span>
          </p>
          <p><strong>Filters for this board:</strong>
            <br><span class="mono"><%= @board.filters.map{ |filter| filter.name }.join(', ') %></span>
          </p>
          <p><strong>Issue types for this board:</strong>
            <br><span class="mono"><%= @board.issue_types.join(', ') %></span>
          </p>
        </div>
      </li>
    </ul>
  </div>
</div>

<script>
  $(function() {
    $('.state').autocomplete({
      data: {
        <% @domain['statuses'].each do |status, _| %>
        "<%= status.html_safe %>": null,
        <% end %>
      }
    });

    $('.datepicker').pickadate({
      selectMonths: true, // Creates a dropdown to control month
      selectYears: 15, // Creates a dropdown of 15 years to control year,
      today: 'Today',
      clear: 'Clear',
      close: 'Ok',
      formatSubmit: 'yyyy-mm-dd',
      hiddenName: true,
      max: true
    });
  });

  function buildComponentUrl(path) {
    return path + '?' + $('#filter-params').serialize();
  }
</script>
