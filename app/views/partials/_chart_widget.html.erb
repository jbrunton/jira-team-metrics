<script>
  $(function() {
    var app = new Vue({
      el: '#chart_widget_app',
      data: {
        data: null,
        chartOpts: null,
        chart: null,

        monthPeriodOptions: [],
        relativePeriodOptions: [],
        timesheetPeriodOptions: [],
        selectedMonthPeriod: null,
        selectedRelativePeriod: null,
        selectedTimesheetPeriod: null
      },
      created: function() {
        google.charts.setOnLoadCallback(this.loadChart);
        $.get('/metrics/api/boards/754/time_period_options.json', this.updateTimePeriods);
      },
      methods: {
        loadChart: function() {
          this.chart = null;
          $.get(this.url, this.drawChart);
        },
        drawChart: function(response) {
          this.data = new google.visualization.DataTable(response.data);
          this.chartOpts = response.chartOpts;
          this.chart = new google.visualization.ComboChart(document.getElementById('chart_widget_div'));
          this.chart.draw(this.data, this.chartOpts);
        },
        updateTimePeriods: function(response) {
          this.monthPeriodOptions = response.month_periods
          this.selectedMonthPeriod = response.selected_month_period
          this.relativePeriodOptions = response.relative_periods
          this.selectedRelativePeriod = response.selected_relative_period
          this.timesheetPeriodOptions = response.timesheet_periods
          this.selectedTimesheetPeriod = response.selected_timesheet_period
          $('.dropdown').dropdown({ on: 'hover' });
        },
      },
      computed: {
        url: function() {
          return '/metrics/api/boards/754/scatterplot.json?from_date=2018-12-14&to_date=2019-01-13&filter=&hierarchy_level=Scope&query=resolution+%3D+%27Done%27+or+resolution+%3D+%27Fixed%27';
        }
      }
    })
  });
</script>



<div id="chart_widget_app">

  <div class="ui tiny menu">
    <span class="item">
      Jump to time period
    </span>

    <div class="item">
      <select class="ui dropdown" v-model="selectedMonthPeriod">
        <option disabled value="">Select Month</option>
        <option v-for="option in monthPeriodOptions"
           v-bind:data-start="option.start_date"
           v-bind:data-end="option.end_date">
          {{ option.label }}
        </option>
      </select>
    </div>

    <div class="item">
      <select class="ui dropdown" v-model="selectedRelativePeriod">
        <option disabled value="">Select Relative Timeframe</option>
        <option v-for="option in relativePeriodOptions"
                v-bind:data-start="option.start_date"
                v-bind:data-end="option.end_date">
          {{ option.label }}
        </option>
      </select>
    </div>

    <div class="item">
      <select class="ui dropdown" v-model="selectedTimesheetPeriod">
        <option disabled value="">Select Timesheet Period</option>
        <option v-for="option in timesheetPeriodOptions"
                v-bind:data-start="option.start_date"
                v-bind:data-end="option.end_date">
          {{ option.label }}
        </option>
      </select>
    </div>

  </div>

  <div v-if="chart == null" style="margin: 100px 0;">
    <div class="ui active centered inline loader"></div>
  </div>

  <div id="chart_widget_div"></div>

</div>
