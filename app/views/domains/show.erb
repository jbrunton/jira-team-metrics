<% content_for :nav_content do %>
    <a href="<%= domains_path %>" class="breadcrumb">Domains</a>
    <a href="#!" class="breadcrumb"><%= @domain['name'] %></a>
<% end %>

<script>
  $(function() {
    $('.modal').modal();

    $('#sync').click(function() {
      $('.modal').modal('close');
      $.get('<%= domain_path(@domain) %>/sync');
    });
  });

  App.cable.subscriptions.create("SyncChannel",
      {
        received: function (data) {
          if (data.status == 'syncing') {
            $('.progress').show();
          } else if (data.status == 'done') {
            $('.progress').hide();
            location.reload();
          }
        }
      });
</script>

<h3>
  <%= @domain['name'] %>
  <!-- Modal Trigger -->
  <a class="waves-effect waves-light btn right" href="#modal1"><i class="material-icons left">system_update_alt</i>Sync</a>
</h3>

<div class="progress" style="display: none;">
  <div class="indeterminate"></div>
</div>

<table>
  <thead>
    <tr>
      <td>Name</td>
      <td>Last Synced</td>
      <td></td>
    </tr>
  </thead>
  <% @boards.each do |board| %>
      <tr>
        <td><%= board.name %></td>
        <td><%= pretty_print_time(board.last_synced) %></td>
        <td>
          <a href="<%= board_path(@domain, board) %>" class="waves-effect waves-light btn">
            <i class="material-icons left">dashboard</i>Summary
          </a>
          <a href="<%= board_control_chart_path(@domain, board) %>" class="waves-effect waves-light btn">
            <i class="material-icons left">trending_up</i>Control Chart
          </a>
          <a href="<%= board_issues_path(@domain, board) %>" class="waves-effect waves-light btn">
            <i class="material-icons left">list</i>Issues
          </a>
        </td>
      </tr>
  <% end %>
</table>

<!-- Modal Structure -->
<div id="modal1" class="modal bottom-sheet">
  <div class="modal-content">
    <%= render partial: 'shared/sync_form' %>
  </div>
  <div class="modal-footer">
    <a id="sync" href="#" class="waves-effect waves-light btn">
      Sync
    </a>
  </div>
</div>