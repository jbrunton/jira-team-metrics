<% breadcrumb :report, @board, :query, 'Custom Query' %>
<% content_for :title, "Custom Query - #{@board.name}" %>

<h1>Query Data</h1>


<div id="app">
  {{ message }}
</div>

<div id="search-params" class="ui form">
  <div class="fields">
    <div class="sixteen wide field">
      <label>Query <a id="query-help"><i class="question circle outline icon"></i></a>
        <div class="ui fluid popup">
          <%= render partial: 'partials/query_help' %>
        </div>
      </label>
      <div class="ui action input">
        <input type="text" class="mono" id="query" name="query" value="<%= @report_params.query || @default_query %>"/>
        <button class="ui button" type="submit" id="search-submit" name="search-submit">Search</button>
      </div>
    </div>
  </div>
</div>

<script>
  var app = new Vue({
    el: '#app',
    data: {
      message: 'Hello Vue!'
    }
  })
</script>


<h1>Legacy</h1>

<%= render partial: 'partials/search_form', locals: { show_search_options: false } %>

<a id="download" href="#">Download</a>

<%= render partial: 'partials/chart', locals: {
  chart_id: generate_id,
  chart_type: 'Table',
  url: "#{board_api_path(@board)}/query.json",
  ready_handler: 'readyHandler'
} %>

<script>
  function readyHandler() {
    var $table = $(document).find('.google-visualization-table table');
    $table.addClass('ui very compact table');

    var csvLink = '<%= "#{board_api_path(@board)}/query.csv?query=" %>' + $('#query').val();
    $('#download').attr('href', csvLink);
  }
</script>

